<div class="task-modal">

  <!-- HEADER -->
  <header class="modal-header">
    <div class="header-icon">
      <mat-icon>{{ isReadOnly ? 'visibility' : isEdit ? 'edit_note' : 'add_circle' }}</mat-icon>
    </div>
    <div class="header-content">
      <h1 class="modal-title">
        {{ isReadOnly ? 'Detalles de tarea' : isEdit ? 'Editar tarea' : 'Crear nueva tarea' }}
      </h1>
      <p class="modal-subtitle">
        {{ isReadOnly ? 'Información completa de la tarea' : isEdit ? 'Actualiza la información de tu tarea' : 'Agrega una nueva tarea a tu tablero Kanban' }}
      </p>
    </div>
  </header>

  <!-- BODY -->
  <section class="modal-body">
    <form [formGroup]="taskForm" class="task-form">

      <!-- INFORMACIÓN PRINCIPAL -->
      <section class="form-section">
        <h3 class="section-title">Información principal</h3>

        <mat-form-field appearance="outline" class="field-dark">
          <mat-label>Título de la tarea</mat-label>
          <input matInput formControlName="title" autocomplete="off" />
          <mat-error *ngIf="taskForm.get('title')?.hasError('required')">
            El título es obligatorio
          </mat-error>
          <mat-error *ngIf="taskForm.get('title')?.hasError('maxlength')">
            Máximo 100 caracteres
          </mat-error>
        </mat-form-field>
      </section>

      <!-- DETALLES ADICIONALES -->
      <section class="form-section">
        <h3 class="section-title">Detalles adicionales</h3>

        <mat-form-field appearance="outline" class="field-dark">
          <mat-label>Descripción (opcional)</mat-label>
          <textarea
            matInput
            formControlName="description"
            rows="3"
          ></textarea>
          <mat-error *ngIf="taskForm.get('description')?.hasError('maxlength')">
            Máximo 500 caracteres
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="field-dark">
          <mat-label>Comentarios/Notas (opcional)</mat-label>
          <textarea
            matInput
            formControlName="comments"
            rows="2"
          ></textarea>
        </mat-form-field>
      </section>

      <!-- CONFIGURACIÓN -->
      <section class="form-section">
        <h3 class="section-title">Configuración</h3>

        <div class="config-grid">
          <mat-form-field appearance="outline" class="field-dark">
            <mat-label>Estado</mat-label>
            <mat-select formControlName="status">
              <mat-option *ngFor="let status of taskStatuses" [value]="status">
                {{ getStatusLabel(status) }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="field-dark">
            <mat-label>Prioridad</mat-label>
            <mat-select formControlName="priority">
              <mat-option [value]="0">Baja</mat-option>
              <mat-option [value]="1">Media</mat-option>
              <mat-option [value]="2">Alta</mat-option>
              <mat-option [value]="3">Urgente</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="field-dark">
            <mat-label>Fecha de vencimiento (opcional)</mat-label>
            <input matInput type="date" formControlName="dueDate" />
          </mat-form-field>

          <mat-form-field appearance="outline" class="field-dark">
            <mat-label>Tags (opcional)</mat-label>
            <mat-select formControlName="tags" multiple>
              <mat-option *ngFor="let tag of availableTags" [value]="tag">
                {{ tag }}
              </mat-option>
            </mat-select>
            <mat-hint>Selecciona uno o más tags para categorizar la tarea</mat-hint>
          </mat-form-field>

          <mat-form-field appearance="outline" class="field-dark">
            <mat-label>Posición</mat-label>
            <input matInput type="number" formControlName="position" min="0" />
          </mat-form-field>
        </div>
      </section>

    </form>
  </section>

  <!-- FOOTER -->
  <footer class="modal-footer">
    <button mat-stroked-button class="cancel-button" (click)="onCancel()">
      <mat-icon>close</mat-icon>
      {{ isReadOnly ? 'Cerrar' : 'Cancelar' }}
    </button>

    <button
      *ngIf="!isReadOnly"
      mat-flat-button
      class="submit-button"
      [class.edit-mode]="isEdit"
      (click)="onSubmit()"
      [disabled]="taskForm.invalid"
    >
      <mat-icon>{{ isEdit ? 'save' : 'add' }}</mat-icon>
      {{ isEdit ? 'Guardar cambios' : 'Crear tarea' }}
    </button>
  </footer>

</div>

