<div class="edit-task-modal">

  <!-- HEADER (Fixed, no scroll) -->
  <header class="modal-header">
    <div class="header-icon">
      <mat-icon>edit_note</mat-icon>
    </div>
    <div class="header-content">
      <h1 class="modal-title">Editar tarea</h1>
      <p class="modal-subtitle">Actualiza la información de tu tarea</p>
    </div>
  </header>

  <!-- BODY (Scrollable) -->
  <section class="modal-body">

    <!-- LOADING -->
    <div *ngIf="isLoading" class="loading-container">
      <mat-icon class="loading-icon">hourglass_empty</mat-icon>
      <p>Cargando tarea...</p>
    </div>

    <!-- FORM -->
    <form *ngIf="!isLoading && taskForm" [formGroup]="taskForm" class="task-form">

      <!-- INFORMACIÓN PRINCIPAL -->
      <div class="form-section">
        <h3 class="section-title">Información principal</h3>
        <div class="grid-2-cols">
          <mat-form-field appearance="outline" class="field-dark">
            <mat-label>Título de la tarea</mat-label>
            <input matInput formControlName="title" autocomplete="off" />
            <mat-error *ngIf="taskForm.get('title')?.hasError('required')">
              El título es obligatorio
            </mat-error>
            <mat-error *ngIf="taskForm.get('title')?.hasError('maxlength')">
              Máximo 100 caracteres
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="field-dark">
            <mat-label>Descripción (opcional)</mat-label>
            <textarea
              matInput
              formControlName="description"
              rows="3"
            ></textarea>
            <mat-error *ngIf="taskForm.get('description')?.hasError('maxlength')">
              Máximo 500 caracteres
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- DETALLES ADICIONALES -->
      <div class="form-section">
        <h3 class="section-title">Detalles adicionales</h3>
        <mat-form-field appearance="outline" class="field-dark full-width">
          <mat-label>Comentarios/Notas (opcional)</mat-label>
          <textarea
            matInput
            formControlName="comments"
            rows="2"
          ></textarea>
        </mat-form-field>
      </div>

      <!-- CONFIGURACIÓN -->
      <div class="form-section">
        <h3 class="section-title">Configuración</h3>
        <div class="grid-2-cols">
          <mat-form-field appearance="outline" class="field-dark">
            <mat-label>Estado</mat-label>
            <mat-select formControlName="status">
              <mat-option *ngFor="let status of taskStatuses" [value]="status">
                {{ getStatusLabel(status) }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="field-dark">
            <mat-label>Prioridad</mat-label>
            <mat-select formControlName="priority">
              <mat-option [value]="0">Baja</mat-option>
              <mat-option [value]="1">Media</mat-option>
              <mat-option [value]="2">Alta</mat-option>
              <mat-option [value]="3">Urgente</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="field-dark">
            <mat-label>Fecha de vencimiento (opcional)</mat-label>
            <input matInput type="date" formControlName="dueDate" />
          </mat-form-field>

          <mat-form-field appearance="outline" class="field-dark">
            <mat-label>Tags (opcional)</mat-label>
            <mat-select formControlName="tags" multiple>
              <mat-option *ngFor="let tag of availableTags" [value]="tag">
                {{ tag }}
              </mat-option>
            </mat-select>
            <mat-hint>Selecciona uno o más tags para categorizar la tarea</mat-hint>
          </mat-form-field>

          <mat-form-field appearance="outline" class="field-dark">
            <mat-label>Posición</mat-label>
            <input matInput type="number" formControlName="position" min="0" />
          </mat-form-field>

          <!-- Espacio vacío para balancear el grid -->
          <div class="empty-space"></div>
        </div>
      </div>


    </form>

  </section>

  <!-- FOOTER (Fixed, no scroll) -->
  <footer class="modal-footer">
    <div class="footer-actions">
      <button mat-stroked-button class="cancel-button" (click)="onCancel()">
        <mat-icon>close</mat-icon>
        Cancelar
      </button>

      <button
        mat-flat-button
        class="submit-button"
        (click)="onSubmit()"
        [disabled]="taskForm?.invalid || isLoading"
      >
        <mat-icon>save</mat-icon>
        Guardar cambios
      </button>
    </div>
  </footer>

</div>
